# 주제 : 브라우저는 어떻게 동작하는가?

## 브라우저의 주요 기능

- 사용자가 선택한 자원을 서버에 요청하고 브라우저에 표시하는 것
- 자원 : HTML, PDF, 이미지
- 자원의 주소는 URI(Uniform Resource Identifier)에 의해 정해진다.
- HTML과 CSS 명세에 따라 HTML 파일을 해석하여 표시
- 명세는 웹 표준화 기구 W3C(World Wide Web Conoritum)에서 정한다.

## 브라우저의 기본 구조

브라우저의 주요 구성 요소

<img src="./Browsers_and_how_they_work/helloworld-59361-1.png"/>

1. 사용자 인터페이스

   - 주소 표시줄
   - 이전/다음 버튼
   - 북마크 메뉴
   - 요청한 페이지를 보여주는 창을 제외한 나머지 모든 부분

2. 브라우저 엔진

   - 사용자 인터페이스와 렌더링 엔진 사이의 동작을 제어

3. 렌더링 엔진

   - 요청한 콘텐츠를 표시
   - HTML을 요청하면 HTMl과 CSS를 파싱하여 화면에 표시

4. 통신

   - HTTP 요청과 같은 네트워크 호출에 사용됨
   - 플랫폼 독립적인 인터페이스, 각 플랫폼 하부에서 실행

5. UI 백엔드

   - 콤보 박스와 창 같은 기본적인 장치를 그림
   - 플랫폼에서 명시하지 않은 일반적인 인터페이스
   - OS 사용자 인터페이스 체계를 사용

6. 자바스크립트 해석기

   - 자바스크립트 코드를 해석하고 실행

7. 자료 저장소
   - 자료를 저장하는 계층
   - 쿠키를 저장하는 것과 같이 모든 종류의 자원을 하드 디스크에 저장할 필요가 있다.
   - HTML5 명세에는 브라우저가 지원하는 '웹 데이터 베이스'가 정의

- 크롬의 경우 각 탭마다 별도의 렌더링 엔진 인스턴스를 유지하는 것이 주목할만한 포인트. 각 탭은 독립된 프로세스로 처리

## 렌더링 엔진

- 요청 받은 내용을 브라우저 화면에 표시
- 파이어폭스 -> 게코(Gecko)엔진
- 사파리 & 크롬 -> 웹킷(Webkit)엔진

## 동작과정

- 통신으로부터 요청한 문서의 내용을 얻는 것으로 시작
- 문서의 내용은 보통 8KB 단위로 전송

<img src="./Browsers_and_how_they_work/helloworld-59361-2.png" />

1. HTMP 문서를 파싱하고 "콘텐츠 트리" 내부에서 태그를 DOM 노드로 변환
2. CSS 파일과 함께 포함된 스타일 요소 파싱
3. 스타일 정봐와 HTML 표시 규칙은 "렌더 트리"를 생성
4. 렌더 트리 생성 후 배치가 시작된다. 노드가 화면의 정확한 위치에 표시되는 것
5. UI 백엔드에서 렌더 트리의 각 노드를 만들어 내는 그리기 과정 시작

<img src="./Browsers_and_how_they_work/helloworld-59361-3.png" />

## 파싱과 DOM 트리 구축

- 렌더링 엔진에서 매우 중요한 과정인 파싱
- 문서 파싱은 브라우저가 코드를 이해하고 사용할 수 이쓴 구조로 변환하는 것을 의미
- 파싱 결과는 보통 문서 구조를 나타내는 노드 트리
- 파싱 트리 or 문법 트리라고 부름

## 파서 - 어휘 분석기 조합

<img src="./Browsers_and_how_they_work/helloworld-59361-6.png" />

- 파싱은 어휘 분석과 구문 분석 두 가지로 구분
- 어휘 분석은 자료를 토큰으로 분해하는 과정 (토큰 : 사전에 등장하는 모든단어)
- 구문 분석은 언어의 구문 규칙을 적용하는 과정

## 변환

<img src="./Browsers_and_how_they_work/helloworld-59361-7.png" />

- 파서 트리는 최종 결과물이 아니다.
- 변환을 거쳐 기계코드 문서로 변환

## HTML 파서

- HTML 마크업을 파싱 트리로 변환

## HTML 문법 정의

- 어휘와 문법은 W3C에 의해 명세로 정의

## 문맥 자유문법이 아니다.

- HTML 정의를 위한 공식정인 형식으로 DTD가 있다.
- DTD는 문맥 자유 문법이 아니다.

## HTML DTD

- HTML의 정의는 DTD 형식안에 존재
- SGML 계열 언어의 정의를 이용한 것
- 허용되는 모든 요소와 그들의 속성 그리고 중첩 구조에 대한 정의를 포함

## DOM

- "파싱 트리"는 DOM 요소와 속성 노드의 트리로서 출력 트리가 된다.
- DOM은 문서 객체 모델의 준말
- 트리의 최상위 책체는 Document

## 파싱 알고리즘

- HTML은 일반적인 하향식 또는 상향식 파서로 파싱이 안된다.
- 일반적인 파싱 기술을 사용할 수 없기 때문에 브라우저는 HTML 파싱을 위해 별도의 파서를 생성
- 알고리즘은 토큰화와 트리 구축 두단계로 구성

<img src="./Browsers_and_how_they_work/helloworld-59361-9.png" />

# References

- https://d2.naver.com/helloworld/59361
